<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>flowium</title>
</head>
<script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous">
</script>
<script src="utils.js"></script>
<script>
function init() {
    var template = getParameterByName('template')
    $("#template").text(template)
}

function create() {
    var template = getParameterByName('template')
    // Get the current version of the template.
    var sha
    ghGet("commits?path=" + template, null, function(commits) {
        var sha = commits[0].sha
        var prologue = '~> __action: create\n' +
                       '~> __template:' + template + "\n" +
                       '~> __version:' + sha + "\n\n"
        // Create the issue.
        var args = {
            "title": $(".title").val(),
            "body": prologue + $(".comment").val(),
        }
        ghPost("issues", args, function(reply) {
            console.log(reply)
            var addr = 'issue.html' +
                '?username=' + getUsername() +
                '&repository=' + getRepository() +
                '&issue=' + reply.number +
                '&token=' + getToken()
            var body = "View in Flowium: <https://flowium.com/issue.hmtl?username=" + getUsername() + "&repository=" + getRepository() + "&issue=" + reply.number + ">"
            ghPost("issues/" + reply.number + "/comments", {"body": body},
                  function(reply) { 
                window.location.href = addr
            })
        })
    })
}


</script>
<body onload="init()">
<h1>Create new issue</h1>
<p>Template: <span id="template">fff</span></p>
<p>Title: <input type="text" name="title" class="title"></p>
<p>Comment: <textarea name="comment" cols="40" rows="5" class="comment"></textarea></p>
<button onclick="create()">Create</button>
</div>
</body>

